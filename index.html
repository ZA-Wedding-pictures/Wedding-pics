<!doctype html>
<html lang="en">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Share your photos and videos with us1!</title>

<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600&display=swap" rel="stylesheet">

<style>
  :root {
    --page-bg: #fafafa;
    --text-primary: #333;
    --accent: #5C1D13;
    --accent-light: #d6a96e;
    --card-bg: #fff;
    --shadow: rgba(0,0,0,.1);
  }
  body {
    margin:0; padding:0 1rem;
    font-family: system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Arial,sans-serif;
    background:var(--page-bg); color:var(--text-primary);
    min-height:100vh; display:flex; align-items:center; justify-content:center;
  }
  h1,h2,h3 { margin:0; font-family:'Cormorant Garamond',serif; color:var(--accent); }

  .card {
    background:var(--card-bg); border-radius:16px;
    box-shadow:0 4px 12px var(--shadow);
    padding:2rem 2.5rem; max-width:460px; width:100%; text-align:center;
  }
  input[type=file],button {
    font:inherit; padding:.75rem 1rem; border-radius:8px;
    width:100%; box-sizing:border-box;
  }
  button {
    background:var(--accent); color:#fff; border:none; margin-top:1rem; cursor:pointer;
    transition:background .3s;
  }
  button.secondary { background:var(--accent-light); margin-top:.5rem; }
  button:hover:not(:disabled) { opacity:.9; }
  button:disabled { background:#ccc; cursor:not-allowed; }

  #msg { margin-top:1rem; font-size:.95rem; min-height:1.2em; }

  /* progress bar */
  #progressWrap { margin-top:1rem; width:100%; height:10px; background:#ddd;
                  border-radius:6px; overflow:hidden; display:none; }
  #progressBar  { height:100%; width:0%; background:var(--accent);
                  transition:width .35s ease; }
</style>

<body>
  <div class="card">
    <h2>Share your photos and videos with us!</h2>
    <p>Choose as many files as you like â€“ large images are resized client-side to speed things up.</p>

    <input type="file" id="file" multiple accept="image/*,video/*" />
    <button id="send">Upload</button>
    <button id="gallery" class="secondary">Show Gallery</button>

    <div id="msg"></div>
    <div id="progressWrap"><div id="progressBar"></div></div>
  </div>

<script>
/* ---------- CONFIG ---------- */
const ENDPOINT = 'https://script.google.com/macros/s/AKfycbyqi94k9S_FdEm441PZL0MbjyzFuGqCWo7ejtKkTi-W9rzfOszM1frUbS3_LV1bNDUO/exec';

/* ---------- helpers ---------- */
const $ = sel => document.querySelector(sel);
function showMessage(txt, ok=false){ $('#msg').textContent=txt; $('#msg').style.color=ok?'var(--accent)':'inherit'; }
function setBar(frac){ $('#progressBar').style.width=(frac*100)+'%'; }

/* ---------- UI events ---------- */
$('#send').onclick    = () => uploadFiles();
$('#gallery').onclick = () => location.href='gallery.html';

/* ---------- upload flow ---------- */
async function uploadFiles(){
  const files=[...$('#file').files];
  if(!files.length) return alert('Pick at least one file first!');

  $('#progressWrap').style.display='block'; setBar(0);
  $('#send').disabled=true;

  try{
    for(let i=0;i<files.length;i++){
      showMessage(`Uploading ${i+1} / ${files.length}â€¦ please wait`);
      await uploadSingle(files[i]);
      setBar((i+1)/files.length);
    }
    showMessage('Thank you so much for celebrating with us. Lots of love, Adiba & Zac ðŸ¥°',true);
    $('#file').value='';
  }catch(err){
    console.error(err);
    showMessage('âŒ Upload failed â€“ please try again.');
  }finally{
    $('#send').disabled=false;
  }
}

/* ---------- per-file upload ---------- */
function downscaleImage(file,maxDim=2400,q=.85){
  return new Promise((res,rej)=>{
    const img=new Image();
    img.onload=()=>{
      let {width:w,height:h}=img;
      if(w>h&&w>maxDim){ h*=maxDim/w; w=maxDim; }
      else if(h>w&&h>maxDim){ w*=maxDim/h; h=maxDim; }
      const c=document.createElement('canvas'); c.width=w; c.height=h;
      c.getContext('2d').drawImage(img,0,0,w,h);
      c.toBlob(b=>b?res(b):rej('toBlob failed'),'image/jpeg',q);
    };
    img.onerror=rej; img.src=URL.createObjectURL(file);
  });
}
function blobToB64(blob){
  return new Promise((res,rej)=>{
    const fr=new FileReader();
    fr.onload=()=>res(fr.result.split(',')[1]);
    fr.onerror=rej; fr.readAsDataURL(blob);
  });
}
async function uploadSingle(file){
  let blob=file, name=file.name, type=file.type||'application/octet-stream';
  if(file.type.startsWith('image/')){
    blob = await downscaleImage(file);
    name = name.replace(/\.[^/.]+$/,'')+'_web.jpg';
    type = 'image/jpeg';
  }
  const b64 = await blobToB64(blob);
  const body=new URLSearchParams({data:b64,filename:name,mimetype:type});
  const res = await fetch(ENDPOINT,{method:'POST',body});
  if(!res.ok) throw new Error(res.statusText);
}
</script>
</body>
</html>
