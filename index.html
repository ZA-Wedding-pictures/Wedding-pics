<!doctype html>
<html lang="en">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Share your photos</title>

<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#fafafa;--text:#333;--accent:#5C1D13;--accentLight:#d6a96e;
    --card:#fff;--shadow:rgba(0,0,0,.1)
  }
  body{margin:0;padding:0 1rem;font-family:system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Arial,sans-serif;background:var(--bg);color:var(--text);min-height:100vh;display:flex;align-items:center;justify-content:center}
  h2{margin:0 0 1rem;font-family:'Cormorant Garamond',serif;color:var(--accent)}
  .card{background:var(--card);border-radius:16px;box-shadow:0 4px 12px var(--shadow);padding:2rem 2.5rem;max-width:460px;width:100%;text-align:center}
  button{font:inherit;padding:.75rem 1rem;border-radius:8px;width:100%;cursor:pointer;border:none;transition:opacity .3s}
  #chooseBtn{background:var(--accentLight);color:#000;margin-top:.5rem}
  #uploadBtn{background:var(--accent);color:#fff;margin-top:1rem}
  button:disabled{background:#ccc;cursor:not-allowed}
  button:hover:not(:disabled){opacity:.9}
  #msg{margin-top:1rem;font-size:.95rem;min-height:1.2em}
  #progressWrap{margin-top:1rem;width:100%;height:10px;background:#ddd;border-radius:6px;overflow:hidden;display:none}
  #progressBar{height:100%;width:0;background:var(--accent);transition:width .35s ease}
  /* hide the actual file input */
  #file{display:none}
</style>

<body>
  <div class="card">
    <h2>Share your photos with us!</h2>
    <p>Upload as many pictures as you like. No video's please :)</p>

    <input type="file" id="file" accept="image/*" multiple>
    <button id="chooseBtn">Choose photos</button>
    <button id="uploadBtn" disabled>Upload</button>
    <button id="galleryBtn" style="background:var(--accentLight);color:#fff;margin-top:.5rem">Show Gallery</button>

    <div id="msg"></div>
    <div id="progressWrap"><div id="progressBar"></div></div>
  </div>

<script>
const ENDPOINT='https://script.google.com/macros/s/AKfycbyqi94k9S_FdEm441PZL0MbjyzFuGqCWo7ejtKkTi-W9rzfOszM1frUbS3_LV1bNDUO/exec';

const $=s=>document.querySelector(s);
function say(t,ok=false){$('#msg').textContent=t;$('#msg').style.color=ok?'var(--accent)':'inherit';}
function bar(f){$('#progressBar').style.width=(f*100)+'%';}

$('#chooseBtn').onclick=()=>$('#file').click();
$('#file').onchange=()=>{$('#uploadBtn').disabled=!$('#file').files.length;if($('#file').files.length){say(`${$('#file').files.length} photo(s) selected`,true);}};

$('#galleryBtn').onclick=()=>location.href='gallery.html';
$('#uploadBtn').onclick  =()=>uploadAll();

async function uploadAll(){
  const list=[...$('#file').files];
  if(!list.length)return;
  $('#progressWrap').style.display='block';bar(0);$('#uploadBtn').disabled=true;
  try{
    for(let i=0;i<list.length;i++){
      say(`Uploading ${i+1}/${list.length}â€¦`);
      await send(list[i]);
      bar((i+1)/list.length);
    }
    say('Thanks for sharing! ðŸŽ‰',true);
    $('#file').value='';$('#uploadBtn').disabled=true;
  }catch(e){console.error(e);say('âŒ Upload failed â€“ please try again.');}
}

const toB64=b=>new Promise((res,rej)=>{const r=new FileReader();r.onload=()=>res(r.result.split(',')[1]);r.onerror=rej;r.readAsDataURL(b);});
async function send(file){
  let blob=file,name=file.name,type=file.type||'application/octet-stream';
  if(type.startsWith('image/')){
    const img=await downscale(file);blob=img;name=name.replace(/\.[^/.]+$/,'')+'_web.jpg';type='image/jpeg';
  }
  const body=new URLSearchParams({data:await toB64(blob),filename:name,mimetype:type});
  const r=await fetch(ENDPOINT,{method:'POST',body});
  if(!r.ok)throw new Error(r.statusText);
}
function downscale(f,max=2400,q=.85){return new Promise((res,rej)=>{const i=new Image();i.onload=()=>{let{width:w,height:h}=i;if(w>h&&w>max){h*=max/w;w=max}else if(h>max){w*=max/h;h=max}const c=document.createElement('canvas');c.width=w;c.height=h;c.getContext('2d').drawImage(i,0,0,w,h);c.toBlob(b=>b?res(b):rej('toBlob fail'),'image/jpeg',q);};i.onerror=rej;i.src=URL.createObjectURL(f);});}
</script>
</body>
</html>
